"use strict";(self.webpackChunkexcel_custom_functions=self.webpackChunkexcel_custom_functions||[]).push([[432],{21432:function(e,t,s){function n(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function r(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}s.r(t),s.d(t,{AI_PROMPT:function(){return Xt},APIConnectionError:function(){return h},APIConnectionTimeoutError:function(){return d},APIError:function(){return l},APIPromise:function(){return se},APIUserAbortError:function(){return u},Anthropic:function(){return Ct},AnthropicError:function(){return c},AuthenticationError:function(){return p},BadRequestError:function(){return f},BaseAnthropic:function(){return Wt},ConflictError:function(){return y},HUMAN_PROMPT:function(){return Dt},InternalServerError:function(){return _},NotFoundError:function(){return m},PagePromise:function(){return re},PermissionDeniedError:function(){return g},RateLimitError:function(){return w},UnprocessableEntityError:function(){return b},default:function(){return Ct},toFile:function(){return me}});let i=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return i=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^s()&15>>+e/4).toString(16)))};function o(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const a=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class c extends Error{}class l extends c{constructor(e,t,s,n){super(`${l.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("request-id"),this.error=t}static makeMessage(e,t,s){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new h({message:s,cause:a(t)});const r=t;return 400===e?new f(e,r,s,n):401===e?new p(e,r,s,n):403===e?new g(e,r,s,n):404===e?new m(e,r,s,n):409===e?new y(e,r,s,n):422===e?new b(e,r,s,n):429===e?new w(e,r,s,n):e>=500?new _(e,r,s,n):new l(e,r,s,n)}}class u extends l{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class h extends l{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class d extends h{constructor({message:e}={}){super({message:e??"Request timed out."})}}class f extends l{}class p extends l{}class g extends l{}class m extends l{}class y extends l{}class b extends l{}class w extends l{}class _ extends l{}const v=/^[a-z][a-z0-9+.-]*:/i;function k(e){return"object"!=typeof e?{}:e??{}}const S=e=>{try{return JSON.parse(e)}catch(e){return}},R={off:0,error:200,warn:300,info:400,debug:500},x=(e,t,s)=>{var n,r;if(e)return n=R,r=e,Object.prototype.hasOwnProperty.call(n,r)?e:void E(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(R))}`)};function M(){}function P(e,t,s){return!t||R[e]>R[s]?M:t[e].bind(t)}const A={error:M,warn:M,info:M,debug:M};let T=new WeakMap;function E(e){const t=e.logger,s=e.logLevel??"off";if(!t)return A;const n=T.get(t);if(n&&n[0]===s)return n[1];const r={error:P("error",t,s),warn:P("warn",t,s),info:P("info",t,s),debug:P("debug",t,s)};return T.set(t,[s,r]),r}const $=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map((([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t])))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e),I="0.53.0",O=()=>{const e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":L(Deno.build.os),"X-Stainless-Arch":q(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":L(globalThis.process.platform??"unknown"),"X-Stainless-Arch":q(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},q=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",L=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let j;function N(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function U(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return N({start(){},async pull(e){const{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await(t.return?.())}})}function W(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const C=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});let D,X;function H(e){let t;return(D??(t=new globalThis.TextEncoder,D=t.encode.bind(t)))(e)}function B(e){let t;return(X??(t=new globalThis.TextDecoder,X=t.decode.bind(t)))(e)}var F,J,K,V;class z{constructor(){F.set(this,void 0),J.set(this,void 0),n(this,F,new Uint8Array,"f"),n(this,J,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?H(e):e;n(this,F,function(e){let t=0;for(const s of e)t+=s.length;const s=new Uint8Array(t);let n=0;for(const t of e)s.set(t,n),n+=t.length;return s}([r(this,F,"f"),t]),"f");const s=[];let i;for(;null!=(i=G(r(this,F,"f"),r(this,J,"f")));){if(i.carriage&&null==r(this,J,"f")){n(this,J,i.index,"f");continue}if(null!=r(this,J,"f")&&(i.index!==r(this,J,"f")+1||i.carriage)){s.push(B(r(this,F,"f").subarray(0,r(this,J,"f")-1))),n(this,F,r(this,F,"f").subarray(r(this,J,"f")),"f"),n(this,J,null,"f");continue}const e=null!==r(this,J,"f")?i.preceding-1:i.preceding,t=B(r(this,F,"f").subarray(0,e));s.push(t),n(this,F,r(this,F,"f").subarray(i.index),"f"),n(this,J,null,"f")}return s}flush(){return r(this,F,"f").length?this.decode("\n"):[]}}function G(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}function Q(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}F=new WeakMap,J=new WeakMap,z.NEWLINE_CHARS=new Set(["\n","\r"]),z.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Y{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new Y((async function*(){if(s)throw new c("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new c("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new c("Attempted to iterate over a response with no body")}const s=new Z,n=new z,r=W(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?H(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=Q(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const t of n.decode(e)){const e=s.decode(t);e&&(yield e)}for(const e of n.flush()){const t=s.decode(e);t&&(yield t)}}(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new l(void 0,S(s.data)??s.data,void 0,e.headers)}n=!0}catch(e){if(o(e))return;throw e}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let s=!1;return new Y((async function*(){if(s)throw new c("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new z,s=W(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(o(e))return;throw e}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new Y((()=>n(e)),this.controller),new Y((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;return N({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:s,done:n}=await t.next();if(n)return e.close();const r=H(JSON.stringify(s)+"\n");e.enqueue(r)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class Z{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e){const t=e.indexOf(":");return-1!==t?[e.substring(0,t),":",e.substring(t+1)]:[e,"",""]}(e);return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function ee(e,t){const{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,o=await(async()=>{if(t.options.stream)return E(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(s,t.controller):Y.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;const n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?te(await s.json(),s):await s.text()})();return E(e).debug(`[${n}] response parsed`,$({retryOfRequestLogID:r,url:s.url,status:s.status,body:o,durationMs:Date.now()-i})),o}function te(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class se extends Promise{constructor(e,t,s=ee){super((e=>{e(null)})),this.responsePromise=t,this.parseResponse=s,K.set(this,void 0),n(this,K,e,"f")}_thenUnwrap(e){return new se(r(this,K,"f"),this.responsePromise,(async(t,s)=>te(e(await this.parseResponse(t,s),s),s.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then((e=>this.parseResponse(r(this,K,"f"),e)))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}K=new WeakMap;class ne{constructor(e,t,s,r){V.set(this,void 0),n(this,V,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new c("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await r(this,V,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(V=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class re extends se{constructor(e,t,s){super(e,t,(async(e,t)=>new s(e,t.response,await ee(e,t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class ie extends ne{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){const e=this.first_id;return e?{...this.options,query:{...k(this.options.query),before_id:e}}:null}const e=this.last_id;return e?{...this.options,query:{...k(this.options.query),after_id:e}}:null}}const oe=()=>{if("undefined"==typeof File){const{process:e}=globalThis,t="string"==typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ae(e,t,s){return oe(),new File(e,t??"unknown_file",s)}function ce(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const le=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ue=new WeakMap,he=async(e,t)=>{if(!await function(e){const t="function"==typeof e?e:e.fetch,s=ue.get(t);if(s)return s;const n=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new e(s).text()}catch{return!0}})();return ue.set(t,n),n}(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const s=new FormData;return await Promise.all(Object.entries(e||{}).map((([e,t])=>de(s,e,t)))),s},de=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let n={};const r=s.headers.get("Content-Type");r&&(n={type:r}),e.append(t,ae([await s.blob()],ce(s),n))}else if(le(s))e.append(t,ae([await new Response(U(s)).blob()],ce(s)));else if((e=>e instanceof Blob&&"name"in e)(s))e.append(t,ae([s],ce(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map((s=>de(e,t+"[]",s))));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map((([s,n])=>de(e,`${t}[${s}]`,n))))}}},fe=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,pe=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&fe(e),ge=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function me(e,t,s){if(oe(),e=await e,t||(t=ce(e)),pe(e))return e instanceof File&&null==t&&null==s?e:ae([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(ge(e)){const n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ae(await ye(n),t,s)}const n=await ye(e);if(!s?.type){const e=n.find((e=>"object"==typeof e&&"type"in e&&e.type));"string"==typeof e&&(s={...s,type:e})}return ae(n,t,s)}async function ye(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(fe(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!le(e)){const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";return`; props: [${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`)}for await(const s of e)t.push(...await ye(s))}return t}class be{constructor(e){this._client=e}}const we=Symbol.for("brand.privateNullableHeaders"),_e=Array.isArray;function*ve(e){if(!e)return;if(we in e){const{values:t,nulls:s}=e;yield*t.entries();for(const e of s)yield[e,null];return}let t,s=!1;e instanceof Headers?t=e.entries():_e(e)?t=e:(s=!0,t=Object.entries(e??{}));for(let e of t){const t=e[0];if("string"!=typeof t)throw new TypeError("expected header name to be a string");const n=_e(e[1])?e[1]:[e[1]];let r=!1;for(const e of n)void 0!==e&&(s&&!r&&(r=!0,yield[t,null]),yield[t,e])}}const ke=e=>{const t=new Headers,s=new Set;for(const n of e){const e=new Set;for(const[r,i]of ve(n)){const n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[we]:!0,values:t,nulls:s}};function Se(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Re=((e=Se)=>function(t,...s){if(1===t.length)return t[0];let n=!1;const r=t.reduce(((t,r,i)=>(/[?#]/.test(r)&&(n=!0),t+r+(i===s.length?"":(n?encodeURIComponent:e)(String(s[i]))))),""),i=r.split(/[?#]/,1)[0],o=[],a=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let l;for(;null!==(l=a.exec(i));)o.push({start:l.index,length:l[0].length});if(o.length>0){let e=0;const t=o.reduce(((t,s)=>{const n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r}),"");throw new c(`Path parameters result in path with invalid segments:\n${r}\n${t}`)}return r})(Se);class xe extends be{list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/files",ie,{query:n,...t,headers:ke([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(Re`/v1/files/${e}`,{...s,headers:ke([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){const{betas:n}=t??{};return this._client.get(Re`/v1/files/${e}/content`,{...s,headers:ke([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){const{betas:n}=t??{};return this._client.get(Re`/v1/files/${e}`,{...s,headers:ke([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){const{betas:s,...n}=e;return this._client.post("/v1/files",(async(e,t)=>({...e,body:await he(e.body,t)}))({body:n,...t,headers:ke([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}class Me extends be{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(Re`/v1/models/${e}?beta=true`,{...s,headers:ke([{...null!=n?.toString()?{"anthropic-beta":n?.toString()}:void 0},s?.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models?beta=true",ie,{query:n,...t,headers:ke([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}class Pe{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new z;for await(const t of this.iterator)for(const s of e.decode(t))yield JSON.parse(s);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new c("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new c("Attempted to iterate over a response with no body")}return new Pe(W(e.body),t)}}class Ae extends be{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:ke([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(Re`/v1/messages/batches/${e}?beta=true`,{...s,headers:ke([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",ie,{query:n,...t,headers:ke([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(Re`/v1/messages/batches/${e}?beta=true`,{...s,headers:ke([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){const{betas:n}=t??{};return this._client.post(Re`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:ke([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){const n=await this.retrieve(e);if(!n.results_url)throw new c(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);const{betas:r}=t??{};return this._client.get(n.results_url,{...s,headers:ke([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap(((e,t)=>Pe.fromResponse(t.response,t.controller)))}}const Te=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return e=e.slice(0,e.length-1),Te(e);case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return e=e.slice(0,e.length-1),Te(e);case"string":let n=e[e.length-2];if("delimiter"===n?.type)return e=e.slice(0,e.length-1),Te(e);if("brace"===n?.type&&"{"===n.value)return e=e.slice(0,e.length-1),Te(e);break;case"delimiter":return e=e.slice(0,e.length-1),Te(e)}return e},Ee=e=>JSON.parse((e=>{let t="";return e.map((e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value})),t})((e=>{let t=[];return e.map((e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))})),t.length>0&&t.reverse().map((t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})})),e})(Te((e=>{let t=0,s=[];for(;t<e.length;){let n=e[t];if("\\"===n){t++;continue}if("{"===n){s.push({type:"brace",value:"{"}),t++;continue}if("}"===n){s.push({type:"brace",value:"}"}),t++;continue}if("["===n){s.push({type:"paren",value:"["}),t++;continue}if("]"===n){s.push({type:"paren",value:"]"}),t++;continue}if(":"===n){s.push({type:"separator",value:":"}),t++;continue}if(","===n){s.push({type:"delimiter",value:","}),t++;continue}if('"'===n){let r="",i=!1;for(n=e[++t];'"'!==n;){if(t===e.length){i=!0;break}if("\\"===n){if(t++,t===e.length){i=!0;break}r+=n+e[t],n=e[++t]}else r+=n,n=e[++t]}n=e[++t],i||s.push({type:"string",value:r});continue}if(n&&/\s/.test(n)){t++;continue}let r=/[0-9]/;if(n&&r.test(n)||"-"===n||"."===n){let i="";for("-"===n&&(i+=n,n=e[++t]);n&&r.test(n)||"."===n;)i+=n,n=e[++t];s.push({type:"number",value:i});continue}let i=/[a-z]/i;if(n&&i.test(n)){let r="";for(;n&&i.test(n)&&t!==e.length;)r+=n,n=e[++t];if("true"!=r&&"false"!=r&&"null"!==r){t++;continue}s.push({type:"name",value:r})}else t++}return s})(e)))));var $e,Ie,Oe,qe,Le,je,Ne,Ue,We,Ce,De,Xe,He,Be,Fe,Je,Ke,Ve,ze,Ge,Qe,Ye;const Ze="__json_buf";function et(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class tt{constructor(){$e.add(this),this.messages=[],this.receivedMessages=[],Ie.set(this,void 0),this.controller=new AbortController,Oe.set(this,void 0),qe.set(this,(()=>{})),Le.set(this,(()=>{})),je.set(this,void 0),Ne.set(this,(()=>{})),Ue.set(this,(()=>{})),We.set(this,{}),Ce.set(this,!1),De.set(this,!1),Xe.set(this,!1),He.set(this,!1),Be.set(this,void 0),Fe.set(this,void 0),Ve.set(this,(e=>{if(n(this,De,!0,"f"),o(e)&&(e=new u),e instanceof u)return n(this,Xe,!0,"f"),this._emit("abort",e);if(e instanceof c)return this._emit("error",e);if(e instanceof Error){const t=new c(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new c(String(e)))})),n(this,Oe,new Promise(((e,t)=>{n(this,qe,e,"f"),n(this,Le,t,"f")})),"f"),n(this,je,new Promise(((e,t)=>{n(this,Ne,e,"f"),n(this,Ue,t,"f")})),"f"),r(this,Oe,"f").catch((()=>{})),r(this,je,"f").catch((()=>{}))}get response(){return r(this,Be,"f")}get request_id(){return r(this,Fe,"f")}async withResponse(){const e=await r(this,Oe,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new tt;return t._run((()=>t._fromReadableStream(e))),t}static createMessage(e,t,s){const n=new tt;for(const e of t.messages)n._addMessageParam(e);return n._run((()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}_run(e){e().then((()=>{this._emitFinal(),this._emit("end")}),r(this,Ve,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),r(this,$e,"m",ze).call(this);const{response:i,data:o}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(i);for await(const e of o)r(this,$e,"m",Ge).call(this,e);if(o.controller.signal?.aborted)throw new u;r(this,$e,"m",Qe).call(this)}_connected(e){this.ended||(n(this,Be,e,"f"),n(this,Fe,e?.headers.get("request-id"),"f"),r(this,qe,"f").call(this,e),this._emit("connect"))}get ended(){return r(this,Ce,"f")}get errored(){return r(this,De,"f")}get aborted(){return r(this,Xe,"f")}abort(){this.controller.abort()}on(e,t){return(r(this,We,"f")[e]||(r(this,We,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=r(this,We,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(r(this,We,"f")[e]||(r(this,We,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{n(this,He,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){n(this,He,!0,"f"),await r(this,je,"f")}get currentMessage(){return r(this,Ie,"f")}async finalMessage(){return await this.done(),r(this,$e,"m",Je).call(this)}async finalText(){return await this.done(),r(this,$e,"m",Ke).call(this)}_emit(e,...t){if(r(this,Ce,"f"))return;"end"===e&&(n(this,Ce,!0,"f"),r(this,Ne,"f").call(this));const s=r(this,We,"f")[e];if(s&&(r(this,We,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return r(this,He,"f")||s?.length||Promise.reject(e),r(this,Le,"f").call(this,e),r(this,Ue,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];r(this,He,"f")||s?.length||Promise.reject(e),r(this,Le,"f").call(this,e),r(this,Ue,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",r(this,$e,"m",Je).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),r(this,$e,"m",ze).call(this),this._connected(null);const n=Y.fromReadableStream(e,this.controller);for await(const e of n)r(this,$e,"m",Ge).call(this,e);if(n.controller.signal?.aborted)throw new u;r(this,$e,"m",Qe).call(this)}[(Ie=new WeakMap,Oe=new WeakMap,qe=new WeakMap,Le=new WeakMap,je=new WeakMap,Ne=new WeakMap,Ue=new WeakMap,We=new WeakMap,Ce=new WeakMap,De=new WeakMap,Xe=new WeakMap,He=new WeakMap,Be=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,$e=new WeakSet,Je=function(){if(0===this.receivedMessages.length)throw new c("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Ke=function(){if(0===this.receivedMessages.length)throw new c("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter((e=>"text"===e.type)).map((e=>e.text));if(0===e.length)throw new c("stream ended without producing a content block with type=text");return e.join(" ")},ze=function(){this.ended||n(this,Ie,void 0,"f")},Ge=function(e){if(this.ended)return;const t=r(this,$e,"m",Ye).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{const s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":et(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":n(this,Ie,t,"f")}},Qe=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");const e=r(this,Ie,"f");if(!e)throw new c("request ended without sending any chunks");return n(this,Ie,void 0,"f"),e},Ye=function(e){let t=r(this,Ie,"f");if("message_start"===e.type){if(t)throw new c(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new c(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{const s=t.content.at(e.index);switch(e.delta.type){case"text_delta":"text"===s?.type&&(s.text+=e.delta.text);break;case"citations_delta":"text"===s?.type&&(s.citations??(s.citations=[]),s.citations.push(e.delta.citation));break;case"input_json_delta":if(s&&et(s)){let t=s[Ze]||"";t+=e.delta.partial_json,Object.defineProperty(s,Ze,{value:t,enumerable:!1,writable:!0}),t&&(s.input=Ee(t))}break;case"thinking_delta":"thinking"===s?.type&&(s.thinking+=e.delta.thinking);break;case"signature_delta":"thinking"===s?.type&&(s.signature=e.delta.signature);break;default:e.delta}return t}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const st={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192},nt={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};class rt extends be{constructor(){super(...arguments),this.batches=new Ae(this._client)}create(e,t){const{betas:s,...n}=e;n.model in nt&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${nt[n.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!n.stream&&null==r){const e=st[n.model]??void 0;r=this._client.calculateNonstreamingTimeout(n.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:n,timeout:r??6e5,...t,headers:ke([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}stream(e,t){return tt.createMessage(this,e,t)}countTokens(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:ke([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}}rt.Batches=Ae;class it extends be{constructor(){super(...arguments),this.models=new Me(this._client),this.messages=new rt(this._client),this.files=new xe(this._client)}}it.Models=Me,it.Messages=rt,it.Files=xe;class ot extends be{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/complete",{body:n,timeout:this._client._options.timeout??6e5,...t,headers:ke([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}var at,ct,lt,ut,ht,dt,ft,pt,gt,mt,yt,bt,wt,_t,vt,kt,St,Rt,xt,Mt,Pt,At;const Tt="__json_buf";function Et(e){return"tool_use"===e.type||"server_tool_use"===e.type}class $t{constructor(){at.add(this),this.messages=[],this.receivedMessages=[],ct.set(this,void 0),this.controller=new AbortController,lt.set(this,void 0),ut.set(this,(()=>{})),ht.set(this,(()=>{})),dt.set(this,void 0),ft.set(this,(()=>{})),pt.set(this,(()=>{})),gt.set(this,{}),mt.set(this,!1),yt.set(this,!1),bt.set(this,!1),wt.set(this,!1),_t.set(this,void 0),vt.set(this,void 0),Rt.set(this,(e=>{if(n(this,yt,!0,"f"),o(e)&&(e=new u),e instanceof u)return n(this,bt,!0,"f"),this._emit("abort",e);if(e instanceof c)return this._emit("error",e);if(e instanceof Error){const t=new c(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new c(String(e)))})),n(this,lt,new Promise(((e,t)=>{n(this,ut,e,"f"),n(this,ht,t,"f")})),"f"),n(this,dt,new Promise(((e,t)=>{n(this,ft,e,"f"),n(this,pt,t,"f")})),"f"),r(this,lt,"f").catch((()=>{})),r(this,dt,"f").catch((()=>{}))}get response(){return r(this,_t,"f")}get request_id(){return r(this,vt,"f")}async withResponse(){const e=await r(this,lt,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new $t;return t._run((()=>t._fromReadableStream(e))),t}static createMessage(e,t,s){const n=new $t;for(const e of t.messages)n._addMessageParam(e);return n._run((()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}_run(e){e().then((()=>{this._emitFinal(),this._emit("end")}),r(this,Rt,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),r(this,at,"m",xt).call(this);const{response:i,data:o}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(i);for await(const e of o)r(this,at,"m",Mt).call(this,e);if(o.controller.signal?.aborted)throw new u;r(this,at,"m",Pt).call(this)}_connected(e){this.ended||(n(this,_t,e,"f"),n(this,vt,e?.headers.get("request-id"),"f"),r(this,ut,"f").call(this,e),this._emit("connect"))}get ended(){return r(this,mt,"f")}get errored(){return r(this,yt,"f")}get aborted(){return r(this,bt,"f")}abort(){this.controller.abort()}on(e,t){return(r(this,gt,"f")[e]||(r(this,gt,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=r(this,gt,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(r(this,gt,"f")[e]||(r(this,gt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{n(this,wt,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){n(this,wt,!0,"f"),await r(this,dt,"f")}get currentMessage(){return r(this,ct,"f")}async finalMessage(){return await this.done(),r(this,at,"m",kt).call(this)}async finalText(){return await this.done(),r(this,at,"m",St).call(this)}_emit(e,...t){if(r(this,mt,"f"))return;"end"===e&&(n(this,mt,!0,"f"),r(this,ft,"f").call(this));const s=r(this,gt,"f")[e];if(s&&(r(this,gt,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return r(this,wt,"f")||s?.length||Promise.reject(e),r(this,ht,"f").call(this,e),r(this,pt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];r(this,wt,"f")||s?.length||Promise.reject(e),r(this,ht,"f").call(this,e),r(this,pt,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",r(this,at,"m",kt).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),r(this,at,"m",xt).call(this),this._connected(null);const n=Y.fromReadableStream(e,this.controller);for await(const e of n)r(this,at,"m",Mt).call(this,e);if(n.controller.signal?.aborted)throw new u;r(this,at,"m",Pt).call(this)}[(ct=new WeakMap,lt=new WeakMap,ut=new WeakMap,ht=new WeakMap,dt=new WeakMap,ft=new WeakMap,pt=new WeakMap,gt=new WeakMap,mt=new WeakMap,yt=new WeakMap,bt=new WeakMap,wt=new WeakMap,_t=new WeakMap,vt=new WeakMap,Rt=new WeakMap,at=new WeakSet,kt=function(){if(0===this.receivedMessages.length)throw new c("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},St=function(){if(0===this.receivedMessages.length)throw new c("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter((e=>"text"===e.type)).map((e=>e.text));if(0===e.length)throw new c("stream ended without producing a content block with type=text");return e.join(" ")},xt=function(){this.ended||n(this,ct,void 0,"f")},Mt=function(e){if(this.ended)return;const t=r(this,at,"m",At).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{const s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":Et(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":n(this,ct,t,"f")}},Pt=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");const e=r(this,ct,"f");if(!e)throw new c("request ended without sending any chunks");return n(this,ct,void 0,"f"),e},At=function(e){let t=r(this,ct,"f");if("message_start"===e.type){if(t)throw new c(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new c(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{const s=t.content.at(e.index);switch(e.delta.type){case"text_delta":"text"===s?.type&&(s.text+=e.delta.text);break;case"citations_delta":"text"===s?.type&&(s.citations??(s.citations=[]),s.citations.push(e.delta.citation));break;case"input_json_delta":if(s&&Et(s)){let t=s[Tt]||"";t+=e.delta.partial_json,Object.defineProperty(s,Tt,{value:t,enumerable:!1,writable:!0}),t&&(s.input=Ee(t))}break;case"thinking_delta":"thinking"===s?.type&&(s.thinking+=e.delta.thinking);break;case"signature_delta":"thinking"===s?.type&&(s.signature=e.delta.signature);break;default:e.delta}return t}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Y(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class It extends be{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(Re`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",ie,{query:e,...t})}delete(e,t){return this._client.delete(Re`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(Re`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const s=await this.retrieve(e);if(!s.results_url)throw new c(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:ke([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap(((e,t)=>Pe.fromResponse(t.response,t.controller)))}}class Ot extends be{constructor(){super(...arguments),this.batches=new It(this._client)}create(e,t){e.model in qt&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${qt[e.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){const t=st[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return $t.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const qt={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};Ot.Batches=It;class Lt extends be{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(Re`/v1/models/${e}`,{...s,headers:ke([{...null!=n?.toString()?{"anthropic-beta":n?.toString()}:void 0},s?.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models",ie,{query:n,...t,headers:ke([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}const jt=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var Nt,Ut;class Wt{constructor({baseURL:e=jt("ANTHROPIC_BASE_URL"),apiKey:t=jt("ANTHROPIC_API_KEY")??null,authToken:s=jt("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){Ut.set(this,void 0);const i={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new c("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=i.baseURL,this.timeout=i.timeout??Ct.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=x(i.logLevel,"ClientOptions.logLevel",this)??x(jt("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),n(this,Ut,C,"f"),this._options=i,this.apiKey=t,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization")||t.has("authorization")))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){return ke([this.apiKeyAuth(e),this.bearerAuth(e)])}apiKeyAuth(e){if(null!=this.apiKey)return ke([{"X-Api-Key":this.apiKey}])}bearerAuth(e){if(null!=this.authToken)return ke([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new c(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${I}`}defaultIdempotencyKey(){return`stainless-node-retry-${i()}`}makeStatusError(e,t,s,n){return l.generate(e,t,s,n)}buildURL(e,t){const s=(e=>v.test(e))(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new c("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((s=>({method:e,path:t,...s}))))}request(e,t=null){return new se(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:i,url:c,timeout:l}=this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:c,options:n});const f="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=void 0===s?"":`, retryOf: ${s}`,g=Date.now();if(E(this).debug(`[${f}] sending request`,$({retryOfRequestLogID:s,method:n.method,url:c,options:n,headers:i.headers})),n.signal?.aborted)throw new u;const m=new AbortController,y=await this.fetchWithTimeout(c,i,l,m).catch(a),b=Date.now();if(y instanceof Error){const e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new u;const r=o(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return E(this).info(`[${f}] connection ${r?"timed out":"failed"} - ${e}`),E(this).debug(`[${f}] connection ${r?"timed out":"failed"} (${e})`,$({retryOfRequestLogID:s,url:c,durationMs:b-g,message:y.message})),this.retryRequest(n,t,s??f);if(E(this).info(`[${f}] connection ${r?"timed out":"failed"} - error; no more retries left`),E(this).debug(`[${f}] connection ${r?"timed out":"failed"} (error; no more retries left)`,$({retryOfRequestLogID:s,url:c,durationMs:b-g,message:y.message})),r)throw new d;throw new h({cause:y})}const w=`[${f}${p}${[...y.headers.entries()].filter((([e])=>"request-id"===e)).map((([e,t])=>", "+e+": "+JSON.stringify(t))).join("")}] ${i.method} ${c} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${b-g}ms`;if(!y.ok){const e=this.shouldRetry(y);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await(e[Symbol.asyncIterator]().return?.());const t=e.getReader(),s=t.cancel();t.releaseLock(),await s}(y.body),E(this).info(`${w} - ${e}`),E(this).debug(`[${f}] response error (${e})`,$({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,durationMs:b-g})),this.retryRequest(n,t,s??f,y.headers)}const r=e?"error; no more retries left":"error; not retryable";E(this).info(`${w} - ${r}`);const i=await y.text().catch((e=>a(e).message)),o=S(i),c=o?void 0:i;throw E(this).debug(`[${f}] response error (${r})`,$({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,message:c,durationMs:Date.now()-g})),this.makeStatusError(y.status,o,c,y.headers)}return E(this).info(w),E(this).debug(`[${f}] response start`,$({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,durationMs:b-g})),{response:y,options:n,controller:m,requestLogID:f,retryOfRequestLogID:s,startTime:g}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new re(this,s,e)}async fetchWithTimeout(e,t,s,n){const{signal:r,method:i,...o}=t||{};r&&r.addEventListener("abort",(()=>n.abort()));const a=setTimeout((()=>n.abort()),s),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||"object"==typeof o.body&&null!==o.body&&Symbol.asyncIterator in o.body,l={signal:n.signal,...c?{duplex:"half"}:{},method:"GET",...o};i&&(l.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(a)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,n){let r;const i=n?.get("retry-after-ms");if(i){const e=parseFloat(i);Number.isNaN(e)||(r=e)}const o=n?.get("retry-after");if(o&&!r){const e=parseFloat(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}var a;return await(a=r,new Promise((e=>setTimeout(e,a)))),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){const s=6e5;if(36e5*e/128e3>s||null!=t&&e>t)throw new c("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return s}buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:n,path:r,query:i}=s,o=this.buildURL(r,i);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new c(`${e} must be an integer`);if(t<0)throw new c(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:a,body:l}=this.buildBody({options:s});return{req:{method:n,headers:this.buildHeaders({options:e,method:n,bodyHeaders:a,retryCount:t}),...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const i=ke([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...j??(j=O()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=ke([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:U(e)}:r(this,Ut,"f").call(this,{body:e,headers:s})}}Nt=Wt,Ut=new WeakMap,Wt.Anthropic=Nt,Wt.HUMAN_PROMPT="\n\nHuman:",Wt.AI_PROMPT="\n\nAssistant:",Wt.DEFAULT_TIMEOUT=6e5,Wt.AnthropicError=c,Wt.APIError=l,Wt.APIConnectionError=h,Wt.APIConnectionTimeoutError=d,Wt.APIUserAbortError=u,Wt.NotFoundError=m,Wt.ConflictError=y,Wt.RateLimitError=w,Wt.BadRequestError=f,Wt.AuthenticationError=p,Wt.InternalServerError=_,Wt.PermissionDeniedError=g,Wt.UnprocessableEntityError=b,Wt.toFile=me;class Ct extends Wt{constructor(){super(...arguments),this.completions=new ot(this),this.messages=new Ot(this),this.models=new Lt(this),this.beta=new it(this)}}Ct.Completions=ot,Ct.Messages=Ot,Ct.Models=Lt,Ct.Beta=it;const{HUMAN_PROMPT:Dt,AI_PROMPT:Xt}=Ct}}]);
//# sourceMappingURL=432.js.map